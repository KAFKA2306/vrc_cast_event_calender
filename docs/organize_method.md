## データ整理プログラムの要件再定義と精度向上策

### 1. 要件の再定義

**目的**: Twitterリストメンバーのプロフィール及び固定ツイートから、VRChatイベントに関する情報を可能な限り正確かつ網羅的に抽出し、整理された形式で出力する。

**抽出対象項目**:

1.  **メンバーのtwitterのリンク**: (既存) ユーザープロフィールのURL。
2.  **プロフィール**: (既存) プロフィール本文。
3.  **イベント名**: (新規) プロフィールやアカウント名から推測されるイベント名 (例: "Caress of spica", "猫メイドカフェ 撫舌喫茶")。
4.  **定期開催時刻 (開始)**: (拡張) イベント開始時刻 (例: "21:00", "22:30")。多様な表記 (`22時`, `午後10時`など) に対応。
5.  **定期開催時刻 (終了)**: (新規) イベント終了時刻 (例: "23:00", "0:30")。時間範囲表記 (`22:00～23:00`) から抽出。
6.  **開催曜日**: (拡張) 開催される曜日 (例: "水", "火・木", "第1・3月", "週末")。複数曜日、特定週に対応。
7.  **開催頻度**: (拡張) 開催頻度 (例: "毎週", "隔週", "毎月", "月2回", "不定期", "8のつく日")。より具体的な表現を抽出。
8.  **参加方法**: (新規) イベントへの参加方法 (例: "リクイン", "グループJoin", "事前応募", "抽選", "当日枠あり")。
9.  **参加詳細/リクイン先**: (拡張) 参加に必要な情報 (VRChatグループID、URL、主催者アカウント名など)。
10. **主催者**: (新規) プロフィール文中の `@` から始まる主催者アカウント名 (複数可)。
11. **固定ツイート**: (既存) 固定ツイートのURL。
12. **情報源**: (新規) 開催情報が主にプロフィールから得られたか、固定ツイートから得られたかを示すフラグ (例: "Profile", "Pinned", "Both")。*※固定ツイート本文の取得が前提。*

**入力**: スクレイピング結果のCSV (`profiles_raw_*.csv`)[4]。`account_id`, `url`, `profile`, `固定ツイート`(URL), `最新ツイート`(URL) 列を含む。可能であれば、固定ツイート本文も含むように`twitter_list_scraper.py`[2] を改修。

**出力**: 上記抽出対象項目を列に持つCSVファイル (`profiles_organized_*.csv`)。

### 2. 抽出精度を高める工夫

#### **正規表現の強化と拡張**

*   **時間**:
    *   `(\d{1,2})時半?` (例: 22時, 22時半) を `XX:00`, `XX:30` に変換。
    *   `午後(\d{1,2})時` → 12を加算して24時間表記に。
    *   時間範囲 `(\d{1,2}[:：]\d{1,2})\s*[-~～]\s*(\d{1,2}[:：]\d{1,2})` から開始時刻と終了時刻を抽出。
    *   `24時` を `00:00` として扱うか検討。
*   **曜日**:
    *   `([月火水木金土日])(?:・([月火水木金土日]))+曜?` で複数曜日 (例: 火・木曜) を抽出。
    *   `(?:第([1-5一二三四五]))?(?:、([1-5一二三四五]))*([月火水木金土日])曜?` で特定週の曜日 (例: 第1、第3月曜) を抽出。漢数字にも対応。
    *   `週末`, `平日` キーワードを抽出。
*   **頻度**:
    *   `(毎週|隔週|毎月|月(\d|一|二|三|四|数)回|年(\d|数)回)` のパターンを拡張。
    *   `(\d+)のつく日` (例: 8のつく日) のパターンを追加。
    *   `不定期(?:（|$$).*?（|$$)?` で不定期開催とその補足情報 (例: 不定期(月1目安)) を抽出。
    *   複数の頻度情報がある場合の優先順位付け（例: 「毎週」 > 「不定期」）。
*   **参加方法/詳細**:
    *   `参加方法[:：は]?\s*(.+?)(?:$|\n|。|￤)` で参加方法に関する記述を広く抽出。
    *   `キーワード`: `リクイン`, `RequestInvite`, `Join\+?`, `グループ`, `事前応募`, `抽選`, `当日枠`, `予約` などを OR 条件で検索。
    *   `VRChatグループID`: `vrc\.group/[a-zA-Z0-9._-]+` パターンで抽出。
    *   `URL`: `https?://[^\s]+` パターンで関連URL (Discord, Google Formなど) を抽出。
*   **主催者**:
    *   `主催[:：]?\s*@([a-zA-Z0-9_]+)` や文中の `@([a-zA-Z0-9_]+)` を複数抽出し、リストとして保持。アカウント名として妥当か（長すぎないかなど）でフィルタリング。

#### **前処理の強化**

*   `unicodedata.normalize('NFKC', text)` で全角英数字・記号を半角に統一。
*   漢数字 (`一`～`九`) を算用数字に変換する関数を用意 (特に第〇週、〇回など)。
*   絵文字や特殊記号の除去（必要に応じて）。
*   連続する改行やスペースの整理。

#### **固定ツイート情報の活用 (要スクレイパー改修)**

*   `twitter_list_scraper.py`[2] を改修し、固定ツイート本文を取得・CSVに保存する。
*   `organize_profiles` 関数内で、プロフィールから抽出した情報が不足している場合（例: 時間が見つからない、頻度が不定期のみなど）、固定ツイート本文に対しても同様の抽出処理を実行し、情報を補完・上書きする。
*   情報源を示すカラム (`情報源`) に記録する。

#### **抽出ロジックの階層化とルールベース整理**

*   まず最も具体的なパターン (例: `毎週水曜22:00～23:00`) を探し、見つかればそれを採用。
*   見つからなければ、より一般的なパターン (例: `水曜`, `22:00`, `毎週`) を個別に探し、組み合わせる。
*   抽出された時間、曜日、頻度の情報から、「定期開催」と言えるかどうかのフラグを立てる。例えば、「不定期」のみの場合は定期開催ではないと判断。
*   `リクイン先` として抽出したものが `@` で始まる場合は主催者候補にも入れる、URLなら参加詳細に入れる、などのルールを追加。

#### **NLTK/spaCy等の自然言語処理ライブラリ利用 (高度)**

*   `spaCy` や `GiNZA` を用いて固有表現抽出 (日付、時間、組織名など) を行い、正規表現の結果を検証・補完する。
*   文の構造を解析し、「開催」「営業」などの動詞に係る時間や曜日を特定する。